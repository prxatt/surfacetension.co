<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surface Tension - Connect With Us</title>
    
    <!-- Fonts: IvyPresto Display from Adobe Fonts & Inter from Google Fonts -->
    <link rel="stylesheet" href="https://use.typekit.net/jhs3mli.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Variables and Base Styles --- */
        :root {
            --color-background: #000000;
            --color-platinum: #E5E4E2;
            --color-white: #FFFFFF;
            --color-emerald: #00FFBF;
            --color-purple: #9400D3;
            --color-teal: #008080;
            --color-silver: #C0C0C0;
            --color-pink: #FF1493;
            --color-orange: #FF4500;
            --font-display: "ivypresto-display", serif;
            --font-sans: "Inter", sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--color-background);
            color: var(--color-platinum);
            font-family: var(--font-sans);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
            min-height: 100vh;
            overscroll-behavior: none;
        }

        /* --- Background Visual --- */
        .canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.8;
        }

        /* --- Main Layout & Content --- */
        .container {
            width: 100%;
            max-width: 680px;
            margin: 0 auto;
            padding: 12vh 2rem 3rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            text-align: center;
        }

        .header, .description, .fun-stats, .link-section {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1.2s forwards cubic-bezier(0.16, 1, 0.3, 1);
        }

        .header { animation-delay: 0.2s; }
        .description { animation-delay: 0.4s; }
        .fun-stats { animation-delay: 0.6s; }
        .link-section { animation-delay: 0.8s; }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Header & Title Styling --- */
        .header {
            width: 100%;
            margin-bottom: 2rem;
        }
        
        .title {
            font-family: var(--font-display);
            font-weight: 400;
            font-size: clamp(2.8rem, 10vw, 5.5rem);
            letter-spacing: 0.03em;
            color: var(--color-platinum);
            margin: 0 0 1rem 0;
            text-transform: uppercase;
            line-height: 1;
        }
        
        .subtitle {
            font-family: var(--font-display);
            font-weight: 400;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            letter-spacing: 0.05em;
            text-transform: uppercase;
            line-height: 1.1;
            margin-top: 1rem;
            color: var(--color-emerald);
            text-shadow: 0 0 5px rgba(0, 255, 191, 0.3), 0 0 10px rgba(0, 255, 191, 0.3), 0 0 20px rgba(0, 255, 191, 0.3);
            animation: neon-flicker 5s infinite alternate;
        }
        
        @keyframes neon-flicker {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                0 0 4px var(--color-emerald),
                0 0 11px var(--color-emerald),
                0 0 19px var(--color-emerald),
                0 0 40px var(--color-emerald),
                0 0 80px #fff,
                0 0 90px #fff;
                opacity: 1;
            }
            20%, 24%, 55% {
                text-shadow: none;
                opacity: 0.9;
            }
        }

        /* --- Description Styling --- */
        .description {
            font-size: clamp(1rem, 1.5vw, 1.1rem);
            color: rgba(229, 228, 226, 0.9);
            max-width: 520px;
            margin: 0 auto 2rem;
            font-weight: 400;
        }

        /* --- Fun Stats Section --- */
        .fun-stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 191, 0.2);
            backdrop-filter: blur(10px);
            min-width: 120px;
        }

        .stat-number {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--color-emerald);
            display: block;
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(229, 228, 226, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .reach-breakdown {
            margin-top: 0.25rem;
        }

        .reach-breakdown small {
            font-size: 0.6rem;
            color: rgba(0, 255, 191, 0.6);
            font-weight: 400;
        }

        /* --- Call to Action --- */
        .cta {
            font-size: 1.1rem;
            color: var(--color-white);
            margin-bottom: 2.5rem;
            font-weight: 500;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* --- Achievement Unlock Effect --- */
        .achievement {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--color-emerald), var(--color-teal));
            color: var(--color-background);
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.9rem;
            transform: translateX(300px);
            transition: transform 0.5s ease;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 255, 191, 0.3);
        }

        .achievement.show {
            transform: translateX(0);
        }

        /* --- Links Grid Styling --- */
        .link-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            margin-bottom: 3rem;
        }

        .social-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.2rem;
            width: 100%;
        }

        .social-platforms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.2rem;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .website-featured {
            display: flex;
            justify-content: center;
            width: 100%;
        }

        .website-featured .link-item {
            max-width: 400px;
            width: 100%;
        }

        .link-item {
            position: relative;
        }

        .link-item a {
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 1px solid rgba(229, 228, 226, 0.15);
            border-radius: 12px;
            text-decoration: none;
            color: var(--color-platinum);
            font-size: 1rem;
            background-color: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .link-item a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .link-item a:hover::before {
            left: 100%;
        }

        .link-item a:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: var(--glow-color);
            box-shadow: 0 8px 30px rgba(0,0,0,0.4), 0 0 40px var(--glow-color);
        }
        
        .link-item a:hover .link-icon {
            color: var(--color-white);
            transform: rotate(360deg) scale(1.2);
        }

        /* --- Dynamic Colors for Social Links --- */
        .link-item.instagram a { --glow-color: #E4405F; }
        .link-item.youtube a { --glow-color: #FF0000; }
        .link-item.tiktok a { --glow-color: #FF0050; }
        .link-item.twitter a { --glow-color: #1DA1F2; }
        .link-item.website a { --glow-color: var(--color-emerald); }

        .link-icon {
            width: 28px;
            height: 28px;
            color: var(--glow-color);
            filter: drop-shadow(0 0 5px var(--glow-color));
            transition: all 0.5s ease;
        }

        .link-text {
            flex-grow: 1;
            text-align: left;
            font-weight: 500;
        }
        
        .sub-text {
            font-size: 0.75rem;
            font-weight: 300;
            color: rgba(229, 228, 226, 0.6);
            margin-top: 0.1rem;
        }

        .follow-count {
            font-size: 0.8rem;
            color: var(--glow-color);
            font-weight: 600;
            opacity: 0.8;
        }

        /* --- Progress Bar --- */
        .progress-section {
            width: 100%;
            max-width: 400px;
            margin: 2rem auto;
            text-align: center;
        }

        .progress-label {
            color: var(--color-emerald);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-emerald), var(--color-teal));
            border-radius: 4px;
            width: 0%;
            transition: width 1s ease;
            animation: progress-glow 2s infinite alternate;
        }

        @keyframes progress-glow {
            0% { box-shadow: 0 0 5px var(--color-emerald); }
            100% { box-shadow: 0 0 15px var(--color-emerald), 0 0 25px var(--color-emerald); }
        }

        .progress-text {
            font-size: 0.8rem;
            color: rgba(229, 228, 226, 0.7);
        }

        /* --- Contact Footer --- */
        .contact-footer {
            width: 100%;
            padding: 3rem 2rem 2rem;
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(229, 228, 226, 0.1);
            margin-top: 2rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1.2s forwards cubic-bezier(0.16, 1, 0.3, 1);
            animation-delay: 1.2s;
        }

        .contact-footer .contact-item {
            max-width: 400px;
        }

        .contact-footer .contact-item a {
            position: relative;
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            border: 1px solid rgba(229, 228, 226, 0.15);
            border-radius: 12px;
            text-decoration: none;
            color: var(--color-platinum);
            font-size: 1rem;
            background-color: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            transition: all 0.4s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            --glow-color: var(--color-orange);
        }

        .contact-footer .contact-item a:hover {
            transform: translateY(-5px) scale(1.02);
            border-color: var(--glow-color);
            box-shadow: 0 8px 25px rgba(0,0,0,0.4), 0 0 30px var(--glow-color);
        }

        /* --- Responsive Design --- */
        @media (max-width: 600px) {
            .container {
                padding: 8vh 1.5rem 4rem;
            }
            .social-platforms {
                grid-template-columns: 1fr;
            }
            .fun-stats {
                gap: 1rem;
            }
            .stat-item {
                min-width: 100px;
                padding: 0.8rem;
            }
        }

    </style>
    <!-- Library Loading: Deferred for non-blocking rendering -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js" defer></script>
</head>
<body>

    <div id="background-canvas-container" class="canvas-container">
        <canvas id="background-canvas"></canvas>
    </div>

    <div id="achievement" class="achievement">
        âš¡ Platform Unlock Achieved!
    </div>

    <main class="container">
        <header class="header">
            <h1 class="title">SURFACE TENSION</h1>
            <h2 class="subtitle">Connect With Us</h2>
        </header>

        <p class="description">
            Multi Dimensional Experiential Brand. Transforming the ordinary into the extraordinary. Join our 8.5K+ community across platforms for exclusive access to our next immersive experiences.
        </p>

        <div class="fun-stats">
            <div class="stat-item">
                <span class="stat-number" id="events-stat">1</span>
                <span class="stat-label">Inaugural Event</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="community-stat">8.5K</span>
                <span class="stat-label">Total Reach</span>
                <div class="reach-breakdown">
                    <small>4K+ IG Â· 4K+ Event Â· Website</small>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="platforms-stat">5</span>
                <span class="stat-label">Platforms</span>
            </div>
        </div>

        <div class="cta">
            ðŸš€ Collect all our socials for exclusive content!
        </div>

        <div class="progress-section">
            <div class="progress-label">Social Collection Progress</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">0 of 5 platforms followed</div>
        </div>

        <div class="link-section">
            <div class="social-platforms">
                <div class="link-item instagram" data-platform="instagram">
                    <a href="https://www.instagram.com/surfacetension.co" target="_blank" rel="noopener noreferrer">
                        <span class="link-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><rect width="18" height="18" x="3" y="3" rx="4"/><circle cx="12" cy="12" r="4"/><line x1="17.5" x2="17.5" y1="6.5" y2="6.5"/></svg>
                        </span>
                        <div class="link-text">
                            <div>Instagram</div>
                            <div class="sub-text">Behind the scenes content</div>
                        </div>
                        <div class="follow-count">Follow</div>
                    </a>
                </div>
                
                <div class="link-item youtube" data-platform="youtube">
                    <a href="https://www.youtube.com/@DigitalDripRadio" target="_blank" rel="noopener noreferrer">
                        <span class="link-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                        </span>
                        <div class="link-text">
                            <div>YouTube</div>
                            <div class="sub-text">Digital Drip Radio channel</div>
                        </div>
                        <div class="follow-count">Subscribe</div>
                    </a>
                </div>
                
                <div class="link-item tiktok" data-platform="tiktok">
                    <a href="https://www.tiktok.com/@surfacetension.co" target="_blank" rel="noopener noreferrer">
                        <span class="link-icon">
                           <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"><path d="M16.6 5.82s.01 0 .01 0c.33 0 .65.02.96.05v3.36c-.97-.26-1.95-.44-2.94-.51v9.33c0 2.02-1.64 3.66-3.66 3.66-2.02 0-3.66-1.64-3.66-3.66s1.64-3.66 3.66-3.66c.23 0 .46.02.68.06V5.21c-1.3-.43-2.69-.6-4.11-.5-3.83.25-6.89 3.38-7.13 7.21-.24 3.83 2.73 7.13 6.56 7.37 3.83.24 7.13-2.73 7.37-6.56V5.82z"/></svg>
                        </span>
                        <div class="link-text">
                            <div>TikTok</div>
                            <div class="sub-text">Immersive moments & teasers</div>
                        </div>
                        <div class="follow-count">Follow</div>
                    </a>
                </div>
                
                <div class="link-item twitter" data-platform="twitter">
                    <a href="https://x.com/surfacetensi_o" target="_blank" rel="noopener noreferrer">
                        <span class="link-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.602.75zM11.47 13.83h1.57L5.48 2.16h-1.7z"/>
                            </svg>
                        </span>
                        <div class="link-text">
                            <div>X (Twitter)</div>
                            <div class="sub-text">First access to announcements</div>
                        </div>
                        <div class="follow-count">Follow</div>
                    </a>
                </div>
            </div>
            
            <div class="website-featured">
                <div class="link-item website" data-platform="website">
                    <a href="https://surfacetension.co" target="_blank" rel="noopener noreferrer">
                        <span class="link-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c1.356 0 2.673-.11 3.955-.329M12 21c-1.356 0 2.673-.11-3.955-.329m0 0a9.006 9.006 0 01-5.68-2.042M12 3c1.356 0 2.673.11 3.955.329m-3.955-.329a9.006 9.006 0 00-5.68 2.042m11.362 0a9.006 9.006 0 01-5.68 2.042" />
                            </svg>
                        </span>
                        <div class="link-text">
                            <div>Website</div>
                            <div class="sub-text">It's an experience - see it for yourself</div>
                        </div>
                        <div class="follow-count">Visit</div>
                    </a>
                </div>
            </div>
        </div>
        
    </main>

    <footer class="contact-footer">
        <div class="contact-item">
            <a href="mailto:connect.surfacetension@gmail.com">
                <span class="link-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                    </svg>
                </span>
                <div class="link-text">
                    <div>Contact Us</div>
                    <div class="sub-text">Collaboration & partnerships</div>
                </div>
                <div class="follow-count">Email</div>
            </a>
        </div>
    </footer>

    <script type="module">
    // Use DOMContentLoaded for faster script execution
    document.addEventListener('DOMContentLoaded', () => {
        
        // Progress tracking and achievements
        let followedPlatforms = 0;
        const totalPlatforms = 5;

        function updateProgress() {
            const percentage = (followedPlatforms / totalPlatforms) * 100;
            document.getElementById('progress-fill').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = `${followedPlatforms} of ${totalPlatforms} platforms followed`;
            
            if (followedPlatforms === totalPlatforms) {
                showAchievement('ðŸ† Digital Drip Collector Unlocked!');
            } else if (followedPlatforms > 0) {
                showAchievement(`âš¡ ${followedPlatforms}/${totalPlatforms} Collected!`);
            }
        }

        function showAchievement(text) {
            const achievement = document.getElementById('achievement');
            achievement.textContent = text;
            achievement.classList.add('show');
            setTimeout(() => {
                achievement.classList.remove('show');
            }, 3000);
        }

        // Track clicks on social links
        document.querySelectorAll('.link-item a').forEach(link => {
            link.addEventListener('click', function(e) {
                const platform = this.closest('.link-item').dataset.platform;
                if (platform && !this.dataset.visited) {
                    this.dataset.visited = 'true';
                    followedPlatforms++;
                    updateProgress();
                    
                    // Add visual feedback
                    this.style.borderColor = 'var(--glow-color)';
                    this.style.background = 'rgba(255,255,255,0.1)';
                }
            });
        });

        // Animate stats on load
        setTimeout(() => {
            const stats = document.querySelectorAll('.stat-number');
            stats.forEach(stat => {
                const targetValue = stat.textContent;
                let currentValue = 0;
                const target = targetValue.includes('K') ? 
                    parseFloat(targetValue.replace('K', '')) * 1000 : 
                    parseInt(targetValue);
                
                const animation = setInterval(() => {
                    if (targetValue.includes('K')) {
                        currentValue += target / 50;
                    } else {
                        currentValue += Math.ceil(target / 50);
                    }
                    
                    if (currentValue >= target) {
                        currentValue = target;
                        clearInterval(animation);
                    }
                    
                    let displayValue = Math.floor(currentValue);
                    if (targetValue.includes('K')) {
                        displayValue = (displayValue / 1000).toFixed(1) + 'K';
                    }
                    stat.textContent = displayValue;
                }, 50);
            });
        }, 1000);
        
        // Robustly check for libraries before initializing the main scene
        function checkAndInit() {
            if (window.THREE && window.gsap) {
                main();
            } else {
                // Poll until libraries are loaded
                setTimeout(checkAndInit, 50);
            }
        }

        function main() {
            // --- Global State ---
            const clock = new THREE.Clock();
            
            // --- Scene Variables ---
            let bgScene, bgCamera, bgRenderer, bgComposer, bgRippleVisual;
            
            // --- VERCEL PERFORMANCE: Enhanced Device Capability Detection ---
            const getPerformanceTier = () => {
                const ua = navigator.userAgent;
                const isMobile = /Mobi|Android|iPhone/i.test(ua);
                const screenArea = window.innerWidth * window.innerHeight * window.devicePixelRatio;
                const memory = navigator.deviceMemory || 2;

                if (isMobile || screenArea < 1000000 || memory < 4) return 'low';
                if (screenArea < 2500000 || memory < 8) return 'medium';
                return 'high';
            };

            const performanceLevel = getPerformanceTier();
            
            // --- Optimized Particle Count ---
            function getAdaptiveParticleCount(baseCount) {
                 if (performanceLevel === 'low') return Math.floor(baseCount * 0.3);
                 if (performanceLevel === 'medium') return Math.floor(baseCount * 0.6);
                 return baseCount;
            }

            // --- Debounce Utility ---
            function debounce(func, wait) {
                let timeout;
                return function(...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), wait);
                };
            }

            /*
             * ==================================
             * == SHADER CODE (BACKGROUND)    ==
             * ==================================
             */
            const backgroundVertexShader = `
                uniform float uTime;
                uniform float uRippleProgress;
                uniform float uRippleMix;
                attribute float aParticleType;
                varying float vAlpha;
                varying vec3 vColor;

                void main() {
                    vec3 greenHaloColor = vec3(0.06, 0.9, 0.6);
                    vec3 greenCenterColor = vec3(0.8, 1.0, 0.9);
                    vec3 platinumHaloColor = vec3(0.7, 0.75, 0.85);
                    vec3 platinumCenterColor = vec3(1.0, 1.0, 1.0);

                    vec3 greenColor = mix(greenCenterColor, greenHaloColor, 0.5);
                    vec3 platinumColor = mix(platinumCenterColor, platinumHaloColor, 0.5);
                    vColor = mix(greenColor, platinumColor, aParticleType) * 1.2;

                    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
                    float dist = length(mvPosition.xy);
                    float originalAnimZ = sin(dist * 1.2 - uTime * 0.15) * 1.5 * exp(-dist * 0.1);
                    float rippleTravel = uRippleProgress * 80.0;
                    float rippleWidth = 7.0;
                    float rippleAmplitude = 10.0;
                    float profile = sin((dist - rippleTravel) / rippleWidth * 3.14159);
                    profile = max(0.0, profile);
                    profile = pow(profile, 2.0);
                    float cinematicAnimZ = profile * rippleAmplitude;
                    mvPosition.z += mix(originalAnimZ, cinematicAnimZ, uRippleMix);
                    float zFactor = 1.0 - clamp(abs(mvPosition.z / 20.0), 0.0, 1.0);
                    gl_PointSize = (zFactor * zFactor) * 3.0 + 1.0;
                    vAlpha = zFactor * 1.2;
                    gl_Position = projectionMatrix * mvPosition;
                }
            `;

            const backgroundFragmentShader = `
                varying float vAlpha;
                varying vec3 vColor;
                void main() {
                    float dist = distance(gl_PointCoord, vec2(0.5));
                    if (dist > 0.5) discard;
                    float strength = 1.0 - dist * 2.0;
                    vec3 finalColor = clamp(vColor, 0.0, 1.5);
                    gl_FragColor = vec4(finalColor, strength * vAlpha);
                }
            `;
            
            // --- Scene and Visuals Setup ---
            function init() {
                initBackgroundScene();
                setupEventListeners();
                animate();
                startMasterAnimationSequence();
            }
            
            function initBackgroundScene() {
                bgScene = new THREE.Scene();
                bgCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                bgCamera.position.z = 2;
                bgRenderer = new THREE.WebGLRenderer({ canvas: document.getElementById('background-canvas'), antialias: performanceLevel !== 'low', alpha: true });
                bgRenderer.setSize(window.innerWidth, window.innerHeight);
                bgRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
                
                const pCount = getAdaptiveParticleCount(80000);
                const geometry = new THREE.BufferGeometry();
                const pos = new Float32Array(pCount * 3);
                const particleTypes = new Float32Array(pCount);
                for (let i = 0; i < pCount; i++) {
                    const i3 = i * 3;
                    const r = Math.random() * 30;
                    const a = Math.random() * Math.PI * 2;
                    pos.set([r * Math.cos(a), r * Math.sin(a), (Math.random() - .5) * 12], i3);
                    particleTypes[i] = Math.random() < 0.2 ? 1.0 : 0.0;
                }
                geometry.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                geometry.setAttribute('aParticleType', new THREE.BufferAttribute(particleTypes, 1));
                
                const material = new THREE.ShaderMaterial({ 
                    vertexShader: backgroundVertexShader, 
                    fragmentShader: backgroundFragmentShader, 
                    uniforms: { 
                        uTime: { value: 0 },
                        uRippleProgress: { value: 0 },
                        uRippleMix: { value: 0 }
                    }, 
                    blending: THREE.AdditiveBlending, 
                    transparent: true, 
                    depthWrite: false 
                });
                bgRippleVisual = new THREE.Points(geometry, material);
                bgScene.add(bgRippleVisual);
                bgComposer = new THREE.EffectComposer(bgRenderer);
                bgComposer.addPass(new THREE.RenderPass(bgScene, bgCamera));
                if (performanceLevel === 'high') {
                    const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 0.4, 0.6, 0.2);
                    bgComposer.addPass(bloomPass);
                }
            }

            function setupEventListeners() {
                window.addEventListener('resize', debounce(onWindowResize, 200), false);
            }

            function startMasterAnimationSequence() {
                const uniforms = bgRippleVisual.material.uniforms;
                function runRippleCycle() {
                    uniforms.uRippleProgress.value = 0;
                    gsap.timeline({
                        onComplete: () => {
                            setTimeout(runRippleCycle, 8000);
                        }
                    })
                    .to(uniforms.uRippleProgress, {
                        value: 1,
                        duration: 20,
                        ease: "power1.inOut"
                    })
                    .fromTo(uniforms.uRippleMix, { value: 0 }, {
                        value: 1,
                        duration: 7,
                        ease: "sine.in"
                    }, 0)
                    .to(uniforms.uRippleMix, {
                        value: 0,
                        duration: 7,
                        ease: "sine.out"
                    }, ">-7");
                }
                setTimeout(runRippleCycle, 6000);
            }
            
            function onWindowResize() { 
                const width = window.innerWidth;
                const height = window.innerHeight;
                bgCamera.aspect = width / height; 
                bgCamera.updateProjectionMatrix(); 
                bgRenderer.setSize(width, height); 
                bgComposer.setSize(width, height);
                bgRenderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            }

            function animate() {
                requestAnimationFrame(animate);
                const elapsedTime = clock.getElapsedTime();
                if (bgRippleVisual) {
                    bgRippleVisual.material.uniforms.uTime.value = elapsedTime;
                    bgComposer.render();
                }
            }
            
            // Initialize the application
            init();
        }

        // Start the process
        checkAndInit();
    });
    </script>
</body>
</html>
